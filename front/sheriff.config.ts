import type { SheriffConfig } from '@softarc/sheriff-core';

import { sameTag } from '@softarc/sheriff-core';

export const sheriffConfig: SheriffConfig = {
  entryFile: './src/main.ts',
  version: 1,
  tagging: {
    'src/app': {
      'app.ts': ['root'],
      'app.config.ts': ['root'],
      'app.routes.ts': ['root'],
      'app.html': ['root'],
      'domains/<domain>': {
        feature: ['domain:<domain>', 'type:feature'],
        ui: ['domain:<domain>', 'type:ui'],
        data: ['domain:<domain>', 'type:data'],
        util: ['domain:<domain>', 'type:util'],
        'autogenerated/models': ['domain:<domain>', 'type:util'],
        'autogenerated/services': ['domain:<domain>', 'type:data', 'type:data:autogenerated'],
      },
    },
  },
  enableBarrelLess: true,
  depRules: {
    // Règle 1: On ne peut importer que ce qui est dans le même domaine ou 'shared'
    'domain:*': [sameTag, 'domain:shared'],

    // Règle 2: La hiérarchie des couches (Feature > UI > Data > Util)
    'type:feature': ['type:ui', 'type:data', 'type:util'],
    'type:ui': ['type:ui', 'type:data', 'type:util'], // UI peut voir d'autres UI, Data et Util
    'type:data': ['type:util', 'type:data:autogenerated'], // Data ne voit que Util
    'type:util': ['type:util'], // Util peut importer d'autres Util (même domaine ou shared grâce à domain:*)

    // Le root (bootstrap) peut tout importer
    root: ['type:feature', 'type:ui', 'type:data', 'type:util', 'domain:shared'],
  },
};
